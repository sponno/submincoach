<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basketball Substitution Manager</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <link href="output.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-0">
<div id="app" class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold mb-4 text-gray-800">SUB ME IN COACH</h1>

    <div v-if="!gameStarted">
        <h2 class="text-2xl font-semibold mb-2">My Players</h2>
        <div class="mb-4 flex space-x-2">
            <input v-model="newPlayerName" @keyup.enter="addPlayer" placeholder="Enter player name"
                   class="border border-gray-300 p-2 rounded-md flex-1"/>
            <button @click="addPlayer" class="bg-purple-500 hover:bg-green-600 text-white py-2 px-4 rounded-md">Add Player</button>
        </div>
        <ul class="mb-4">
            <li v-for="player in allPlayers" :key="player.id" class="flex items-center w-full">
                <div class="flex items-center justify-between bg-gray-100 p-4 rounded-md mb-2 w-full mr-4">
                    <span>{{ player.name }}</span>
                    <label class="flex items-center">present &nbsp;<input type="checkbox" v-model="player.present" class="w-4 h-4"></label>
                </div>
                <button @click="removePlayer(player)">&times;</button>
            </li>
        </ul>
        <button @click="startGame" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-md">Start Game</button>
    </div>

    <div v-else>
        <div class="game-controls mb-6  items-center ">
            <h2 class="text-2xl font-semibold">Game Time: {{ formatTime(gameTime) }}</h2>
            <div class="flex items-center gap-x-6">
            <button @click="toggleTimer" class="text-sm bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-3 rounded-md">
                {{ timerRunning ? 'Pause' : 'Resume' }}
            </button>
            <button @click="nextHalf" v-if="currentHalf < 2" class="text-sm bg-purple-500 hover:bg-purple-600 text-white py-2 px-3 rounded-md">
                Next Half
            </button>
                <button @click="resetGame" class="text-sm bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded-md">Reset Game</button>
            </div>
        </div>

        <h3 class="text-xl font-semibold mb-2">On Court</h3>
        <transition-group name="fade" tag="ul" class="mb-4 space-y-2">
            <li v-for="player in onCourtPlayers" :key="player.id" class="bg-green-100 p-4 rounded-md flex items-center justify-between">
                <span>{{ player.name }} - played: {{ formatTime(player.timePlayed) }}</span>
                <button @click="substituteOut(player)" class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded-md">Sub Out
                </button>
            </li>
        </transition-group>

        <h3 class="text-xl font-semibold mb-2">On Bench</h3>
        <transition-group name="fade" tag="ul" class="space-y-2">
            <li v-for="player in benchPlayers" :key="player.id" class="bg-red-100 p-4 rounded-md flex items-center justify-between">
                <span>{{ player.name }} - played: {{ formatTime(player.timePlayed) }}</span>
                <button @click="substituteIn(player)" class="bg-blue-500 hover:bg-blue-600 text-white py-1 px-3 rounded-md">Sub In</button>
            </li>
        </transition-group>
    </div>
</div>

<script>
    const {createApp, ref, computed, onMounted, onUnmounted, watch} = Vue

    createApp({
        setup() {
            const allPlayers = ref([])
            const newPlayerName = ref('')
            const gameStarted = ref(false)
            const gameTime = ref(0)
            const timerRunning = ref(false)
            const currentHalf = ref(1)
            let timerInterval

            const loadPlayers = () => {
                const storedPlayers = localStorage.getItem('basketballPlayers')
                if (storedPlayers) {
                    allPlayers.value = JSON.parse(storedPlayers).map(p => ({...p, present: false, onCourt: false, timePlayed: 0}))
                }
            }

            const savePlayers = () => {
                localStorage.setItem('basketballPlayers', JSON.stringify(allPlayers.value.map(({id, name}) => ({id, name}))))
            }

            const addPlayer = () => {
                if (newPlayerName.value.trim()) {
                    allPlayers.value.push({
                        id: Date.now(),
                        name: newPlayerName.value.trim(),
                        present: true,
                        onCourt: false,
                        timePlayed: 0
                    })
                    newPlayerName.value = ''
                    savePlayers()
                }
            }

            const removePlayer = (player) => {
                const index = allPlayers.value.findIndex(p => p.id === player.id)
                allPlayers.value.splice(index, 1)
                savePlayers()
            }

            const presentPlayers = computed(() => allPlayers.value.filter(p => p.present))
            const onCourtPlayers = computed(() => presentPlayers.value.filter(p => p.onCourt))
            const benchPlayers = computed(() => presentPlayers.value.filter(p => !p.onCourt))

            const startGame = () => {
                gameStarted.value = true
                startTimer()
            }

            const startTimer = () => {
                timerRunning.value = true
                timerInterval = setInterval(() => {
                    gameTime.value++
                    onCourtPlayers.value.forEach(p => p.timePlayed++)
                }, 1000)
            }

            const toggleTimer = () => {
                if (timerRunning.value) {
                    clearInterval(timerInterval)
                    timerRunning.value = false
                } else {
                    startTimer()
                }
            }

            const substituteOut = (player) => {
                player.onCourt = false
                const index = presentPlayers.value.findIndex(p => p.id === player.id)
                presentPlayers.value.splice(index, 1)
                presentPlayers.value.push(player)
            }

            const substituteIn = (player) => {
                player.onCourt = true
                const index = presentPlayers.value.findIndex(p => p.id === player.id)
                presentPlayers.value.splice(index, 1)
                presentPlayers.value.push(player)
            }

            const resetGame = () => {
                gameTime.value = 0
                currentHalf.value = 1
                presentPlayers.value.forEach(p => {
                    p.onCourt = false
                    p.timePlayed = 0
                })
                if (timerRunning.value) {
                    clearInterval(timerInterval)
                    timerRunning.value = false
                }
            }

            const nextHalf = () => {
                if (currentHalf.value < 2) {
                    currentHalf.value++
                }
            }

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60)
                const secs = seconds % 60
                return `${mins}:${secs.toString().padStart(2, '0')}`
            }

            onMounted(() => {
                loadPlayers()
            })

            onUnmounted(() => {
                clearInterval(timerInterval)
            })

            watch(allPlayers, savePlayers, {deep: true})

            return {
                allPlayers,
                newPlayerName,
                removePlayer,
                gameStarted,
                gameTime,
                timerRunning,
                currentHalf,
                presentPlayers,
                onCourtPlayers,
                benchPlayers,
                addPlayer,
                startGame,
                toggleTimer,
                substituteOut,
                substituteIn,
                resetGame,
                nextHalf,
                formatTime
            }
        }
    }).mount('#app')
</script>
</body>
</html>